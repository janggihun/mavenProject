<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.project.projectFinal.dao.JhlChampDao">



	<select id="champRank">

		SELECT *
		FROM champRankT
		WHERE teamPosition =
		#{teamPosition}
		order by win_total_cnt desc;

	</select>

	<select id="laneListInfo">

		SELECT *
		FROM champListT
		where line like
		concat('%',#{teamPosition}, '%')

	</select>

	<select id="rankListTeamPositionInfo">

		SELECT *
		FROM rankListT
		where teamPosition =
		#{teamPosition} and championId = #{championId}

	</select>

	<!-- <select id="rankListTeamPositionInfo"> -->

	<!-- SELECT * -->
	<!-- FROM -->
	<!-- <choose> -->
	<!-- <when test="tier == 'Emerald'"> -->
	<!-- Emerald_rankListT -->
	<!-- </when> -->
	<!-- <when test="tier == 'Diamond'"> -->
	<!-- Diamond_rankListT -->
	<!-- </when> -->
	<!-- <when test="tier == 'Master'"> -->
	<!-- Master_rankListT -->
	<!-- </when> -->
	<!-- <when test="tier == 'Grandmaster'"> -->
	<!-- Grandmaster_rankListT -->
	<!-- </when> -->
	<!-- <when test="tier == 'Challenger'"> -->
	<!-- Challenger_rankListT -->
	<!-- </when> -->
	<!-- </choose> -->
	<!-- where teamPosition = -->
	<!-- #{teamPosition} and championId = #{championId} -->

	<!-- </select> -->



	<insert id="saveChampRankT">


		REPLACE into champRankT(teamPosition,champion_name
		,champion_name_kr,pick_rate
		,win_rate,win_total_cnt
		,champion_pick,ban_rate)


		values(#{teamPosition},#{champion_name},#{champion_name_kr}
		,#{pick_rate},#{win_rate},#{win_total_cnt}
		,#{champion_pick},#{ban_rate} )


	</insert>
	<select id="allChampCnt">
		select count(*) from rankListT where teamPosition =
		#{teamPosition} ;

	</select>
	<select id="banChampCnt">
		select count(*)
		from rankListT
		where
		ban_champion_name_kr = #{champion_name_kr} ;

	</select>

	<!-- <select id="rankListInfo"> -->
	<!-- SELECT * -->
	<!-- FROM rankListT; -->
	<!-- </select> -->

	<!-- <select id="laneCounterListInfo"> -->
	<!-- SELECT * -->
	<!-- FROM champListT -->
	<!-- where line like -->
	<!-- concat('%',#{teamPosition}, '%') -->
	<!-- </select> -->


	<select id="rankListInfo">
		select
		T1.championName,
		T1.teamPosition,
		SUM(CASE WHEN T1.win = 1 THEN 1 ELSE 0 END) AS champ_win_cnt,
		ROUND((SUM(CASE WHEN T1.win = 1 THEN 1 ELSE 0 END) / COUNT(*))
		* 100, 2) AS win_rate,
		T2.championName AS enemy_championName,
		T2.teamPosition,
		SUM(CASE WHEN T2.win = 1 THEN 1 ELSE 0 END) AS enemy_champ_win_cnt,
		count(*) AS total,
		ROUND((SUM(CASE WHEN T2.win = 1 THEN 1 ELSE 0 END) / COUNT(*)) * 100, 2) AS
		enemy_win_rate

		FROM (SELECT match_id, championName, WIN, teamPosition FROM rankListT
		WHERE championName = #{championName}) T1 JOIN
		(SELECT match_id, championName, WIN, teamPosition FROM rankListT) T2
		ON T1.match_id=T2.match_id AND T1.teamPosition = T2.teamPosition
		WHERE T1.championName!=T2.championName and T1.teamPosition=#{teamPosition}
		GROUP BY T1.championName ,T2.championName
		order by enemy_win_rate desc;


	</select>

	<!-- <select id="rankListCounterA"> -->
	<!-- SELECT * -->
	<!-- FROM rankListT -->
	<!-- where teamPosition = -->
	<!-- #{teamPosition} and championId = -->
	<!-- #{championId}; -->
	<!-- </select> -->

	<!-- <select id="rankListCounterEnemy"> -->
	<!-- SELECT * -->
	<!-- FROM rankListT -->
	<!-- where teamPosition = -->
	<!-- #{teamPosition1} and -->
	<!-- match_id =#{match_id}; -->
	<!-- </select> -->



	<!-- <select id="rankAllListCounter"> -->
	<!-- SELECT -->
	<!-- T1.match_id, -->
	<!-- T1.teamPosition, -->
	<!-- T1.championId AS -->
	<!-- cId1, -->
	<!-- T1.championName AS cname1, -->
	<!-- T1.champion_name_kr AS cnameK1, -->
	<!-- T1.win -->
	<!-- AS win1, -->
	<!-- T2.match_id, -->
	<!-- T2.championId AS cId2, -->
	<!-- T2.championName AS cname2, -->
	<!-- T2.champion_name_kr AS cnameK2, -->
	<!-- T2.win AS win2 -->
	<!-- FROM -->
	<!-- (SELECT * -->
	<!-- FROM -->
	<!-- rankListT -->
	<!-- WHERE championId = #{championIdM}) AS T1 -->
	<!-- JOIN -->
	<!-- (SELECT * -->
	<!-- FROM -->
	<!-- rankListT -->
	<!-- WHERE championId = #{championIdE}) AS T2 -->
	<!-- ON T1.match_id = -->
	<!-- T2.match_id AND T1.teamPosition = T2.teamPosition -->
	<!-- WHERE T1.teamPosition -->
	<!-- = #{teamPosition2} and T1.championId != T2.championId -->
	<!-- GROUP BY -->
	<!-- T1.championId; -->
	<!-- </select> -->


	<!-- <insert id="saveChampCounterT"> -->

	<!-- REPLACE into champCountertest(match_id, -->
	<!-- teamPosition,championIdM,championNameM,cnameKM,winM -->
	<!-- ,championIdE,championNameE,cnameKE,winE,tier) -->

	<!-- values(#{match_id}, -->
	<!-- #{teamPosition},#{championIdM},#{championNameM},#{cnameKM},#{winM}, -->
	<!-- #{championIdE},#{championNameE},#{cnameKE},#{winE},#{tier} ) -->

	<!-- </insert> -->
</mapper>