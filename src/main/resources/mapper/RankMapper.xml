<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.project.projectFinal.dao.JhlChampDao">

	<select id="champRank">

		SELECT *
		FROM champRankT
		WHERE teamPosition =
		#{teamPosition}
		order by win_total_cnt desc;

	</select>

	<select id="laneListInfo">

		SELECT *
		FROM champListT
		where line like
		concat('%',#{teamPosition}, '%')

	</select>

	<select id="rankListTeamPositionInfo">

		SELECT *
		FROM rankListT
		where teamPosition =
		#{teamPosition} and championId = #{championId}

	</select>

		<select id="ranktierlistInfo">
			SELECT *
			FROM
			<choose>
				<when test="tier == 'diamond'">
					diamond_rankListT
				</when>
				<when test="tier == 'emerald'">
					emerald_rankListT
				</when>
				<when test="tier == 'platinum'">
					platinum_rankListT
				</when>
				<when test="tier == 'gold'">
					gold_rankListT
				</when>
				<when test="tier == 'silver'">
					silver_rankListT
				</when>
				<when test="tier == 'brozne'">
					brozne_rankListT
				</when>
			</choose>
			where teamPosition =
			#{teamPosition} and championId = #{championId}
	
		</select>



	<insert id="saveChampRankT">


		REPLACE into champRankT(teamPosition,champion_name
		,champion_name_kr,pick_rate
		,win_rate,win_total_cnt
		,champion_pick,ban_rate)


		values(#{teamPosition},#{champion_name},#{champion_name_kr}
		,#{pick_rate},#{win_rate},#{win_total_cnt}
		,#{champion_pick},#{ban_rate} )


	</insert>
	<select id="allChampCnt">
		select count(*) from rankListT where teamPosition =
		#{teamPosition} ;

	</select>
	<select id="banChampCnt">
		select count(*)
		from rankListT
		where
		ban_champion_name_kr = #{champion_name_kr} ;

	</select>

	<select id="laneCounterListInfo">
		SELECT *
		FROM champListT
		where line like
		concat('%',#{teamPosition}, '%')
	</select>


	<select id="rankListInfo">
		select
		T1.championName,
		T1.champion_name_kr,
		SUM(CASE
		WHEN T1.win = 1 THEN 1 ELSE 0 END) AS champ_win_cnt,
		ROUND((SUM(CASE
		WHEN T1.win = 1 THEN 1 ELSE 0 END) / COUNT(*))
		* 100, 2) AS
		champ_win_rate,
		T2.championName AS enemy_championName,
		T2.champion_name_kr As enemy_championName_kr,
		T2.teamPosition,
		SUM(CASE
		WHEN T2.win = 1 THEN 1 ELSE 0 END) AS enemy_champ_win_cnt,
		count(*) AS
		total,
		ROUND((SUM(CASE WHEN T2.win = 1 THEN 1 ELSE 0 END) / COUNT(*)) *
		100,
		2) AS
		enemy_win_rate,
		T2.tier
		FROM (SELECT * FROM rankListT
		WHERE
		championId = #{championId}) T1 JOIN
		(SELECT * FROM rankListT) T2
		ON
		T1.match_id=T2.match_id AND T1.teamPosition = T2.teamPosition
		WHERE
		T1.championId!=T2.championId and T1.teamPosition=#{teamPosition}
		GROUP
		BY T1.championId ,T2.championId
		order by total desc
		limit 10;
	</select>

	<insert id="saveChampCounterT">

		REPLACE into champCountertest(championName,
		champion_name_kr,champ_win_cnt,champ_win_rate,enemy_championName,enemy_championName_kr,teamPosition,enemy_champ_win_cnt,total,enemy_win_rate,tier)

		values(#{championName},
		#{champion_name_kr},#{champ_win_cnt},#{champ_win_rate},
		#{enemy_championName},#{enemy_championName_kr},#{teamPosition},#{enemy_champ_win_cnt},
		#{total},#{enemy_win_rate},#{tier} )

	</insert>

	<select id="CounterchampList">
		select * from champCountertest WHERE
		championName =
		#{championName}
	</select>
</mapper>